---
globs: *.py
alwaysApply: false
---

# AI脚本开发规范

## 基本要求
- 尽量使用开源的代码进行开发
- 必须同时支持openai和ollama两种模型
- 每次编写完成脚本，都必须要进行测试，测试时默认使用本地的ollama: `http://localhost:11434`、模型使用`qwen2.5:7b`进行测试

## 标准测试流程
使用项目根目录的 `test.sh` 脚本进行标准化测试：

### 测试脚本用法
```bash
# 运行完整测试套件
./test.sh

# 仅测试短文本翻译
./test.sh --short

# 仅测试长文本翻译  
./test.sh --long

# 仅进行性能测试
./test.sh --perf

# 使用指定模型测试
./test.sh --model qwen:32b

# 显示帮助信息
./test.sh --help
```

### 测试内容
标准测试包括以下项目：
1. **依赖检查** - 验证Python3、ollama服务、模型可用性
2. **短文本翻译** - 测试基本翻译功能
3. **中文长文本翻译** - 验证中文长文本分段翻译
4. **英文长文本翻译** - 验证英文长文本分段翻译  
5. **性能测试** - 检查翻译响应时间
6. **格式验证** - 确保返回Alfred标准JSON格式

### 测试要求
- 所有测试必须通过才能提交代码
- 测试失败时需要检查错误日志并修复问题
- 新功能开发后必须更新测试用例
- 测试脚本本身也需要维护和更新

### 环境配置
测试脚本会自动设置以下环境变量：
- `USE_OLLAMA=true` - 使用ollama模式
- `OPENAI_API_URL=http://localhost:11434/api/chat` - API地址
- `MODEL=qwen2.5:7b` - 默认测试模型
- `DEBUG=true` - 开启调试输出
- `LONG_TEXT_THRESHOLD=100` - 长文本检测阈值
- `MAX_SEGMENT_LENGTH=300` - 最大段落长度
